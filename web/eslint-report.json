[{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\admin\\custom-fields\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\admin\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\admin\\media\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Plus' is defined but never used.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":14}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Plus, Upload } from 'lucide-react';\r\n\r\nexport default function MediaPage() {\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-bold tracking-tight\">Media Library</h1>\r\n                    <p className=\"text-muted-foreground\">\r\n                        Manage your images and files\r\n                    </p>\r\n                </div>\r\n                <Button>\r\n                    <Upload className=\"mr-2 h-4 w-4\" />\r\n                    Upload Files\r\n                </Button>\r\n            </div>\r\n\r\n            <Card>\r\n                <CardHeader>\r\n                    <CardTitle>All Media</CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                    <div className=\"flex min-h-[400px] items-center justify-center rounded-lg border-2 border-dashed\">\r\n                        <div className=\"text-center\">\r\n                            <Upload className=\"mx-auto h-12 w-12 text-muted-foreground\" />\r\n                            <h3 className=\"mt-4 text-lg font-semibold\">No media files</h3>\r\n                            <p className=\"mt-2 text-sm text-muted-foreground\">\r\n                                Upload your first file to get started\r\n                            </p>\r\n                            <Button className=\"mt-4\">\r\n                                <Upload className=\"mr-2 h-4 w-4\" />\r\n                                Upload Files\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\admin\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\admin\\post-types\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\admin\\posts\\new\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\admin\\posts\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\admin\\settings\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\admin\\taxonomies\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\admin\\users\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\api\\admin\\organizations\\[orgId]\\custom-fields\\[fieldId]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\api\\admin\\organizations\\[orgId]\\custom-fields\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'desc' is defined but never used.","line":1,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'buildSearchCondition' is defined but never used.","line":5,"column":59,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":79}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { eq, and, sql, like, desc } from 'drizzle-orm';\r\nimport { nanoid } from 'nanoid';\r\nimport { withAuth } from '@/lib/api/auth-wrapper';\r\nimport { successResponse, paginatedResponse, Errors } from '@/lib/api/response';\r\nimport { validateRequest, getPaginationParams, getOffset, buildSearchCondition, parseSortParam } from '@/lib/api/validation';\r\nimport { createCustomFieldSchema } from '@/lib/validations/post-type';\r\nimport { customFields } from '@/db/schema';\r\n\r\n// GET /api/admin/organizations/:orgId/custom-fields - List custom fields\r\nexport const GET = withAuth(\r\n  async (request, { db, organizationId }) => {\r\n    const url = new URL(request.url);\r\n    const { page, perPage } = getPaginationParams(url);\r\n    const offset = getOffset(page, perPage);\r\n\r\n    const search = url.searchParams.get('search') ?? undefined;\r\n    const fieldType = url.searchParams.get('field_type') ?? undefined;\r\n    const sort = url.searchParams.get('sort') ?? 'createdAt_desc';\r\n\r\n    const whereClauses = [eq(customFields.organizationId, organizationId!)];\r\n\r\n    if (search) {\r\n      // Search name (most common use case)\r\n      whereClauses.push(like(customFields.name, `%${search}%`));\r\n    }\r\n\r\n    if (fieldType) {\r\n      whereClauses.push(eq(customFields.fieldType, fieldType));\r\n    }\r\n\r\n    const orderBy = parseSortParam(sort, {\r\n      createdAt: customFields.createdAt,\r\n      updatedAt: customFields.updatedAt,\r\n      name: customFields.name,\r\n      slug: customFields.slug,\r\n    }, 'createdAt', 'desc');\r\n\r\n    const allFields = await db.query.customFields.findMany({\r\n      where: and(...whereClauses),\r\n      limit: perPage,\r\n      offset,\r\n      orderBy,\r\n    });\r\n\r\n    const totalResult = await db\r\n      .select({ count: sql<number>`count(*)` })\r\n      .from(customFields)\r\n      .where(and(...whereClauses));\r\n    const total = totalResult[0]?.count || 0;\r\n\r\n    return paginatedResponse(allFields, page, perPage, total);\r\n  },\r\n  {\r\n    requiredPermission: 'custom-fields:read',\r\n    requireOrgAccess: true,\r\n  }\r\n);\r\n\r\n// POST /api/admin/organizations/:orgId/custom-fields - Create custom field\r\nexport const POST = withAuth(\r\n  async (request, { db, organizationId }) => {\r\n    const validation = await validateRequest(request, createCustomFieldSchema);\r\n    if (!validation.success) return validation.response;\r\n\r\n    const { name, slug, fieldType, settings } = validation.data;\r\n\r\n    // Check if slug already exists in this organization\r\n    const existing = await db.query.customFields.findFirst({\r\n      where: and(\r\n        eq(customFields.organizationId, organizationId!),\r\n        eq(customFields.slug, slug)\r\n      ),\r\n    });\r\n\r\n    if (existing) {\r\n      return Errors.badRequest('Custom field with this slug already exists in this organization');\r\n    }\r\n\r\n    const newField = await db\r\n      .insert(customFields)\r\n      .values({\r\n        id: nanoid(),\r\n        organizationId: organizationId!,\r\n        name,\r\n        slug,\r\n        fieldType,\r\n        settings: settings ? JSON.stringify(settings) : null,\r\n        createdAt: new Date(),\r\n        updatedAt: new Date(),\r\n      })\r\n      .returning();\r\n\r\n    return successResponse(newField[0]);\r\n  },\r\n  {\r\n    requiredPermission: 'custom-fields:create',\r\n    requireOrgAccess: true,\r\n  }\r\n);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\api\\admin\\organizations\\[orgId]\\media\\[mediaId]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\api\\admin\\organizations\\[orgId]\\media\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\api\\admin\\organizations\\[orgId]\\post-types\\[typeId]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\api\\admin\\organizations\\[orgId]\\post-types\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\api\\admin\\organizations\\[orgId]\\posts\\[postId]\\publish\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\api\\admin\\organizations\\[orgId]\\posts\\[postId]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'relationships' is assigned a value but never used.","line":69,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":69,"endColumn":52},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fieldIds' is assigned a value but never used.","line":112,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":112,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { eq, and, sql } from 'drizzle-orm';\r\nimport { nanoid } from 'nanoid';\r\nimport { withAuth } from '@/lib/api/auth-wrapper';\r\nimport { successResponse, Errors } from '@/lib/api/response';\r\nimport { validateRequest } from '@/lib/api/validation';\r\nimport { updatePostSchema } from '@/lib/validations/post';\r\nimport { posts, postFieldValues, postTaxonomies } from '@/db/schema';\r\n\r\n// GET /api/admin/organizations/:orgId/posts/:postId\r\nexport const GET = withAuth(\r\n  async (request, { db, organizationId }, params) => {\r\n    const postId = params?.postId;\r\n    if (!postId) return Errors.badRequest('Post ID required');\r\n\r\n    const post = await db.query.posts.findFirst({\r\n      where: and(\r\n        eq(posts.id, postId),\r\n        eq(posts.organizationId, organizationId!)\r\n      ),\r\n      with: {\r\n        author: true,\r\n        postType: true,\r\n        fieldValues: true,\r\n        // taxonomies: true, // Need to setup relation properly in schema if not already\r\n      },\r\n    });\r\n\r\n    if (!post) {\r\n      return Errors.notFound('Post');\r\n    }\r\n\r\n    // Fetch taxonomies separately if relation is complex\r\n    const taxonomies = await db.query.postTaxonomies.findMany({\r\n      where: eq(postTaxonomies.postId, postId),\r\n      with: {\r\n        // term: true, // Assuming term relation exists\r\n      }\r\n    });\r\n\r\n    return successResponse({ ...post, taxonomies });\r\n  },\r\n  {\r\n    requiredPermission: 'posts:read',\r\n    requireOrgAccess: true,\r\n  }\r\n);\r\n\r\n// PATCH /api/admin/organizations/:orgId/posts/:postId\r\nexport const PATCH = withAuth(\r\n  async (request, { db, organizationId }, params) => {\r\n    const postId = params?.postId;\r\n    if (!postId) return Errors.badRequest('Post ID required');\r\n\r\n    const validation = await validateRequest(request, updatePostSchema);\r\n    if (!validation.success) return validation.response;\r\n\r\n    // Get current post to check postTypeId if slug is being updated\r\n    const currentPost = await db.query.posts.findFirst({\r\n      where: and(\r\n        eq(posts.id, postId),\r\n        eq(posts.organizationId, organizationId!)\r\n      ),\r\n    });\r\n\r\n    if (!currentPost) {\r\n      return Errors.notFound('Post');\r\n    }\r\n\r\n    const { customFields, taxonomies, relationships, ...postData } = validation.data;\r\n\r\n    // Check slug conflict if slug is being updated\r\n    // Posts have unique slugs per organization + post type\r\n    // Note: postTypeId cannot be changed in update, so we use currentPost.postTypeId\r\n    if (postData.slug) {\r\n      const existing = await db.query.posts.findFirst({\r\n        where: and(\r\n          eq(posts.organizationId, organizationId!),\r\n          eq(posts.postTypeId, currentPost.postTypeId),\r\n          eq(posts.slug, postData.slug),\r\n          sql`${posts.id} != ${postId}`\r\n        ),\r\n      });\r\n\r\n      if (existing) {\r\n        return Errors.badRequest('Post with this slug already exists for this post type');\r\n      }\r\n    }\r\n\r\n    // Update post core data\r\n    const updated = await db\r\n      .update(posts)\r\n      .set({\r\n        ...postData,\r\n        updatedAt: new Date(),\r\n      })\r\n      .where(\r\n        and(\r\n          eq(posts.id, postId),\r\n          eq(posts.organizationId, organizationId!)\r\n        )\r\n      )\r\n      .returning();\r\n\r\n    if (!updated.length) {\r\n      return Errors.notFound('Post');\r\n    }\r\n\r\n    // Update custom fields if provided\r\n    if (customFields) {\r\n      // Delete existing values for fields being updated\r\n      // This is a simplified approach; production might need smarter diffing\r\n      const fieldIds = Object.keys(customFields);\r\n      // We can't easily delete only specific fields without complex query\r\n      // So we'll delete all for this post and re-insert (or upsert if supported)\r\n      \r\n      // Better approach: Upsert each field value\r\n      for (const [fieldId, value] of Object.entries(customFields)) {\r\n        // Check if exists\r\n        const existing = await db.query.postFieldValues.findFirst({\r\n            where: and(\r\n                eq(postFieldValues.postId, postId),\r\n                eq(postFieldValues.customFieldId, fieldId)\r\n            )\r\n        });\r\n\r\n        if (existing) {\r\n             await db.update(postFieldValues)\r\n                .set({ \r\n                    value: typeof value === 'string' ? value : JSON.stringify(value),\r\n                    updatedAt: new Date() \r\n                })\r\n                .where(eq(postFieldValues.id, existing.id));\r\n        } else {\r\n            await db.insert(postFieldValues).values({\r\n                id: nanoid(),\r\n                postId,\r\n                customFieldId: fieldId,\r\n                value: typeof value === 'string' ? value : JSON.stringify(value),\r\n                createdAt: new Date(),\r\n                updatedAt: new Date()\r\n            });\r\n        }\r\n      }\r\n    }\r\n\r\n    // Update taxonomies if provided\r\n    if (taxonomies) {\r\n        // Simplified: Delete all and re-insert\r\n        await db.delete(postTaxonomies).where(eq(postTaxonomies.postId, postId));\r\n        \r\n        const taxonomyValues = Object.values(taxonomies).flat().map((termId) => ({\r\n            id: nanoid(),\r\n            postId,\r\n            taxonomyTermId: termId,\r\n            createdAt: new Date(),\r\n        }));\r\n\r\n        if (taxonomyValues.length > 0) {\r\n            await db.insert(postTaxonomies).values(taxonomyValues);\r\n        }\r\n    }\r\n\r\n    return successResponse(updated[0]);\r\n  },\r\n  {\r\n    requiredPermission: 'posts:update',\r\n    requireOrgAccess: true,\r\n  }\r\n);\r\n\r\n// DELETE /api/admin/organizations/:orgId/posts/:postId\r\nexport const DELETE = withAuth(\r\n  async (request, { db, organizationId }, params) => {\r\n    const postId = params?.postId;\r\n    if (!postId) return Errors.badRequest('Post ID required');\r\n\r\n    const deleted = await db\r\n      .delete(posts)\r\n      .where(\r\n        and(\r\n          eq(posts.id, postId),\r\n          eq(posts.organizationId, organizationId!)\r\n        )\r\n      )\r\n      .returning();\r\n\r\n    if (!deleted.length) {\r\n      return Errors.notFound('Post');\r\n    }\r\n\r\n    return successResponse({ deleted: true });\r\n  },\r\n  {\r\n    requiredPermission: 'posts:delete',\r\n    requireOrgAccess: true,\r\n  }\r\n);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\api\\admin\\organizations\\[orgId]\\posts\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'desc' is defined but never used.","line":1,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'asc' is defined but never used.","line":1,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":49},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'postRelationships' is defined but never used.","line":7,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":67}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { eq, and, like, desc, sql, gte, lte, asc } from 'drizzle-orm';\r\nimport { nanoid } from 'nanoid';\r\nimport { withAuth } from '@/lib/api/auth-wrapper';\r\nimport { successResponse, paginatedResponse, Errors } from '@/lib/api/response';\r\nimport { validateRequest, getPaginationParams, getOffset, parseDateParam, parseSortParam } from '@/lib/api/validation';\r\nimport { createPostSchema } from '@/lib/validations/post';\r\nimport { posts, postFieldValues, postTaxonomies, postRelationships } from '@/db/schema';\r\n\r\n// GET /api/admin/organizations/:orgId/posts\r\nexport const GET = withAuth(\r\n  async (request, { db, organizationId }) => {\r\n    const url = new URL(request.url);\r\n    const { page, perPage } = getPaginationParams(url);\r\n    const offset = getOffset(page, perPage);\r\n\r\n    // Get filter parameters\r\n    const postType = url.searchParams.get('post_type') ?? undefined;\r\n    const status = url.searchParams.get('status') ?? undefined;\r\n    const search = url.searchParams.get('search') ?? undefined;\r\n    const authorId = url.searchParams.get('author_id') ?? undefined;\r\n    const createdFrom = url.searchParams.get('created_from') ?? undefined;\r\n    const createdTo = url.searchParams.get('created_to') ?? undefined;\r\n    const publishedFrom = url.searchParams.get('published_from') ?? undefined;\r\n    const publishedTo = url.searchParams.get('published_to') ?? undefined;\r\n    const sort = url.searchParams.get('sort') ?? 'createdAt_desc';\r\n\r\n    // Build where conditions\r\n    const conditions = [eq(posts.organizationId, organizationId!)];\r\n    if (postType) conditions.push(eq(posts.postTypeId, postType));\r\n    if (status) conditions.push(eq(posts.status, status));\r\n    if (authorId) conditions.push(eq(posts.authorId, authorId));\r\n    if (search) {\r\n      // Search title (most common use case)\r\n      conditions.push(like(posts.title, `%${search}%`));\r\n    }\r\n\r\n    // Date range filters\r\n    if (createdFrom) {\r\n      const fromDate = parseDateParam(createdFrom);\r\n      if (!fromDate) {\r\n        return Errors.badRequest('Invalid created_from date format');\r\n      }\r\n      conditions.push(gte(posts.createdAt, fromDate));\r\n    }\r\n\r\n    if (createdTo) {\r\n      const toDate = parseDateParam(createdTo);\r\n      if (!toDate) {\r\n        return Errors.badRequest('Invalid created_to date format');\r\n      }\r\n      conditions.push(lte(posts.createdAt, toDate));\r\n    }\r\n\r\n    if (publishedFrom) {\r\n      const fromDate = parseDateParam(publishedFrom);\r\n      if (!fromDate) {\r\n        return Errors.badRequest('Invalid published_from date format');\r\n      }\r\n      conditions.push(gte(posts.publishedAt, fromDate));\r\n    }\r\n\r\n    if (publishedTo) {\r\n      const toDate = parseDateParam(publishedTo);\r\n      if (!toDate) {\r\n        return Errors.badRequest('Invalid published_to date format');\r\n      }\r\n      conditions.push(lte(posts.publishedAt, toDate));\r\n    }\r\n\r\n    const orderBy = parseSortParam(sort, {\r\n      createdAt: posts.createdAt,\r\n      updatedAt: posts.updatedAt,\r\n      publishedAt: posts.publishedAt,\r\n      title: posts.title,\r\n      slug: posts.slug,\r\n    }, 'createdAt', 'desc');\r\n\r\n    const allPosts = await db.query.posts.findMany({\r\n      where: and(...conditions),\r\n      limit: perPage,\r\n      offset,\r\n      orderBy,\r\n      with: {\r\n        author: true,\r\n        postType: true,\r\n      },\r\n    });\r\n\r\n    const totalResult = await db\r\n      .select({ count: sql<number>`count(*)` })\r\n      .from(posts)\r\n      .where(and(...conditions));\r\n    const total = totalResult[0]?.count || 0;\r\n\r\n    return paginatedResponse(allPosts, page, perPage, total);\r\n  },\r\n  {\r\n    requiredPermission: 'posts:read',\r\n    requireOrgAccess: true,\r\n  }\r\n);\r\n\r\n// POST /api/admin/organizations/:orgId/posts\r\nexport const POST = withAuth(\r\n  async (request, { db, user, organizationId }) => {\r\n    const validation = await validateRequest(request, createPostSchema);\r\n    if (!validation.success) return validation.response;\r\n\r\n    const { customFields, taxonomies, relationships, ...postData } = validation.data;\r\n\r\n    // Check if slug already exists for this post type in this organization\r\n    const existing = await db.query.posts.findFirst({\r\n      where: and(\r\n        eq(posts.organizationId, organizationId!),\r\n        eq(posts.postTypeId, postData.postTypeId),\r\n        eq(posts.slug, postData.slug)\r\n      ),\r\n    });\r\n\r\n    if (existing) {\r\n      return Errors.badRequest('Post with this slug already exists for this post type');\r\n    }\r\n\r\n    // Create post\r\n    const newPost = await db\r\n      .insert(posts)\r\n      .values({\r\n        id: nanoid(),\r\n        organizationId: organizationId!,\r\n        authorId: user.id,\r\n        ...postData,\r\n        createdAt: new Date(),\r\n        updatedAt: new Date(),\r\n      })\r\n      .returning();\r\n\r\n    const post = newPost[0];\r\n\r\n    // Insert custom field values\r\n    if (customFields) {\r\n      const fieldValues = Object.entries(customFields).map(([fieldId, value]) => ({\r\n        id: nanoid(),\r\n        postId: post.id,\r\n        customFieldId: fieldId,\r\n        value: typeof value === 'string' ? value : JSON.stringify(value),\r\n        createdAt: new Date(),\r\n        updatedAt: new Date(),\r\n      }));\r\n\r\n      if (fieldValues.length > 0) {\r\n        await db.insert(postFieldValues).values(fieldValues);\r\n      }\r\n    }\r\n\r\n    // Insert taxonomies\r\n    if (taxonomies) {\r\n      const taxonomyValues = Object.values(taxonomies).flat().map((termId) => ({\r\n        id: nanoid(),\r\n        postId: post.id,\r\n        taxonomyTermId: termId,\r\n        createdAt: new Date(),\r\n      }));\r\n\r\n      if (taxonomyValues.length > 0) {\r\n        await db.insert(postTaxonomies).values(taxonomyValues);\r\n      }\r\n    }\r\n\r\n    // Insert relationships\r\n    if (relationships) {\r\n        // This part needs careful implementation based on relationship structure\r\n        // For now, we'll skip complex relationship insertion in initial create\r\n        // and handle it in update or separate endpoint if needed\r\n    }\r\n\r\n    return successResponse(post);\r\n  },\r\n  {\r\n    requiredPermission: 'posts:create',\r\n    requireOrgAccess: true,\r\n  }\r\n);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\api\\admin\\organizations\\[orgId]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\api\\admin\\organizations\\[orgId]\\taxonomies\\[taxonomyId]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\api\\admin\\organizations\\[orgId]\\taxonomies\\[taxonomyId]\\terms\\[termId]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\api\\admin\\organizations\\[orgId]\\taxonomies\\[taxonomyId]\\terms\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\api\\admin\\organizations\\[orgId]\\taxonomies\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\api\\admin\\organizations\\[orgId]\\users\\[userId]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\api\\admin\\organizations\\[orgId]\\users\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'like' is defined but never used.","line":1,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'desc' is defined but never used.","line":1,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'asc' is defined but never used.","line":1,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'buildSearchCondition' is defined but never used.","line":5,"column":59,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":79},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'parseSortParam' is defined but never used.","line":5,"column":81,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":95}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { eq, and, sql, like, desc, asc } from 'drizzle-orm';\r\nimport { nanoid } from 'nanoid';\r\nimport { withAuth } from '@/lib/api/auth-wrapper';\r\nimport { successResponse, paginatedResponse, Errors } from '@/lib/api/response';\r\nimport { validateRequest, getPaginationParams, getOffset, buildSearchCondition, parseSortParam } from '@/lib/api/validation';\r\nimport { z } from 'zod';\r\nimport { usersOrganizations, users, roles } from '@/db/schema';\r\n\r\nconst addUserSchema = z.object({\r\n  email: z.string().email(),\r\n  roleId: z.string().min(1),\r\n});\r\n\r\n// GET /api/admin/organizations/:orgId/users - List users in organization\r\nexport const GET = withAuth(\r\n  async (request, { db, organizationId }) => {\r\n    const url = new URL(request.url);\r\n    const { page, perPage } = getPaginationParams(url);\r\n    const offset = getOffset(page, perPage);\r\n\r\n    const search = url.searchParams.get('search') ?? undefined;\r\n    const roleId = url.searchParams.get('role_id') ?? undefined;\r\n    const sort = url.searchParams.get('sort') ?? 'createdAt_desc';\r\n\r\n    // Build where conditions - need to join with users table for search\r\n    const whereConditions = [eq(usersOrganizations.organizationId, organizationId!)];\r\n    \r\n    if (roleId) {\r\n      whereConditions.push(eq(usersOrganizations.roleId, roleId));\r\n    }\r\n\r\n    // Note: Search requires a join, so we'll do it differently\r\n    // For now, fetch and filter in memory if search is needed\r\n    // In production, you'd want a proper join query\r\n\r\n    const orgUsers = await db.query.usersOrganizations.findMany({\r\n      where: and(...whereConditions),\r\n      limit: perPage,\r\n      offset,\r\n      with: {\r\n        user: true,\r\n        role: true,\r\n      },\r\n    });\r\n\r\n    // Filter by search if provided (search in user name or email)\r\n    let filteredUsers = orgUsers;\r\n    if (search) {\r\n      const searchLower = search.toLowerCase();\r\n      filteredUsers = orgUsers.filter(\r\n        (uo) =>\r\n          uo.user.name.toLowerCase().includes(searchLower) ||\r\n          uo.user.email.toLowerCase().includes(searchLower)\r\n      );\r\n    }\r\n\r\n    // Apply sorting\r\n    const [sortField, sortOrder] = sort.split('_');\r\n    if (sortField === 'name') {\r\n      filteredUsers.sort((a, b) => {\r\n        const cmp = a.user.name.localeCompare(b.user.name);\r\n        return sortOrder === 'desc' ? -cmp : cmp;\r\n      });\r\n    } else if (sortField === 'email') {\r\n      filteredUsers.sort((a, b) => {\r\n        const cmp = a.user.email.localeCompare(b.user.email);\r\n        return sortOrder === 'desc' ? -cmp : cmp;\r\n      });\r\n    } else {\r\n      // Default: createdAt\r\n      filteredUsers.sort((a, b) => {\r\n        const aTime = a.createdAt?.getTime() || 0;\r\n        const bTime = b.createdAt?.getTime() || 0;\r\n        return sortOrder === 'desc' ? bTime - aTime : aTime - bTime;\r\n      });\r\n    }\r\n\r\n    // Get total count (for search, we need to count filtered results)\r\n    let total = 0;\r\n    if (search) {\r\n      total = filteredUsers.length;\r\n      // Re-slice for pagination after filtering\r\n      const start = offset;\r\n      const end = start + perPage;\r\n      filteredUsers = filteredUsers.slice(start, end);\r\n    } else {\r\n      const totalResult = await db\r\n        .select({ count: sql<number>`count(*)` })\r\n        .from(usersOrganizations)\r\n        .where(and(...whereConditions));\r\n      total = totalResult[0]?.count || 0;\r\n    }\r\n\r\n    return paginatedResponse(filteredUsers, page, perPage, total);\r\n  },\r\n  {\r\n    requiredPermission: 'users:read',\r\n    requireOrgAccess: true,\r\n  }\r\n);\r\n\r\n// POST /api/admin/organizations/:orgId/users - Add user to organization\r\nexport const POST = withAuth(\r\n  async (request, { db, organizationId }) => {\r\n    const validation = await validateRequest(request, addUserSchema);\r\n    if (!validation.success) return validation.response;\r\n\r\n    const { email, roleId } = validation.data;\r\n\r\n    // 1. Find user by email\r\n    const user = await db.query.users.findFirst({\r\n      where: eq(users.email, email),\r\n    });\r\n\r\n    if (!user) {\r\n      return Errors.notFound('User not found. User must log in at least once.');\r\n    }\r\n\r\n    // 2. Check if role exists\r\n    const role = await db.query.roles.findFirst({\r\n      where: eq(roles.id, roleId),\r\n    });\r\n\r\n    if (!role) {\r\n      return Errors.notFound('Role');\r\n    }\r\n\r\n    // 3. Check if user is already in organization\r\n    const existingMember = await db.query.usersOrganizations.findFirst({\r\n      where: and(\r\n        eq(usersOrganizations.userId, user.id),\r\n        eq(usersOrganizations.organizationId, organizationId!)\r\n      ),\r\n    });\r\n\r\n    if (existingMember) {\r\n      return Errors.badRequest('User is already a member of this organization');\r\n    }\r\n\r\n    // 4. Add user to organization\r\n    const newMember = await db\r\n      .insert(usersOrganizations)\r\n      .values({\r\n        id: nanoid(),\r\n        userId: user.id,\r\n        organizationId: organizationId!,\r\n        roleId,\r\n        createdAt: new Date(),\r\n        updatedAt: new Date(),\r\n      })\r\n      .returning();\r\n\r\n    return successResponse(newMember[0]);\r\n  },\r\n  {\r\n    requiredPermission: 'users:create',\r\n    requireOrgAccess: true,\r\n  }\r\n);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\api\\admin\\organizations\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'desc' is defined but never used.","line":1,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'buildSearchCondition' is defined but never used.","line":5,"column":59,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":79}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { eq, and, sql, like, desc } from 'drizzle-orm';\r\nimport { nanoid } from 'nanoid';\r\nimport { withAuth } from '@/lib/api/auth-wrapper';\r\nimport { successResponse, paginatedResponse, Errors } from '@/lib/api/response';\r\nimport { validateRequest, getPaginationParams, getOffset, buildSearchCondition, parseSortParam } from '@/lib/api/validation';\r\nimport { createOrganizationSchema } from '@/lib/validations/organization';\r\nimport { organizations } from '@/db/schema';\r\nimport { isSuperAdmin } from '@/lib/auth/middleware';\r\n\r\n// GET /api/admin/organizations - List organizations (super admin only)\r\nexport const GET = withAuth(async (request, { db, user }) => {\r\n  // Only super admins can list all organizations\r\n  if (!isSuperAdmin(user)) {\r\n    return Errors.forbidden();\r\n  }\r\n\r\n  const url = new URL(request.url);\r\n  const { page, perPage } = getPaginationParams(url);\r\n  const offset = getOffset(page, perPage);\r\n\r\n  const search = url.searchParams.get('search') ?? undefined;\r\n  const sort = url.searchParams.get('sort') ?? 'createdAt_desc';\r\n\r\n  const whereClauses = [];\r\n  if (search) {\r\n    // Search name (most common use case)\r\n    whereClauses.push(like(organizations.name, `%${search}%`));\r\n  }\r\n\r\n  const orderBy = parseSortParam(sort, {\r\n    createdAt: organizations.createdAt,\r\n    updatedAt: organizations.updatedAt,\r\n    name: organizations.name,\r\n    slug: organizations.slug,\r\n  }, 'createdAt', 'desc');\r\n\r\n  const allOrgs = await db.query.organizations.findMany({\r\n    where: whereClauses.length > 0 ? and(...whereClauses) : undefined,\r\n    limit: perPage,\r\n    offset,\r\n    orderBy,\r\n  });\r\n\r\n  const totalResult = await db\r\n    .select({ count: sql<number>`count(*)` })\r\n    .from(organizations)\r\n    .where(whereClauses.length > 0 ? and(...whereClauses) : undefined);\r\n  const total = totalResult[0]?.count || 0;\r\n\r\n  return paginatedResponse(allOrgs, page, perPage, total);\r\n});\r\n\r\n// POST /api/admin/organizations - Create organization (super admin only)\r\nexport const POST = withAuth(async (request, { db, user }) => {\r\n  // Only super admins can create organizations\r\n  if (!isSuperAdmin(user)) {\r\n    return Errors.forbidden();\r\n  }\r\n\r\n  const validation = await validateRequest(request, createOrganizationSchema);\r\n  if (!validation.success) return validation.response;\r\n\r\n  const { name, slug, domain, settings } = validation.data;\r\n\r\n  // Check if slug already exists\r\n  const existing = await db.query.organizations.findFirst({\r\n    where: eq(organizations.slug, slug),\r\n  });\r\n\r\n  if (existing) {\r\n    return Errors.badRequest('Organization with this slug already exists');\r\n  }\r\n\r\n  const newOrg = await db\r\n    .insert(organizations)\r\n    .values({\r\n      id: nanoid(),\r\n      name,\r\n      slug,\r\n      domain: domain || null,\r\n      settings: settings ? JSON.stringify(settings) : null,\r\n      createdAt: new Date(),\r\n      updatedAt: new Date(),\r\n    })\r\n    .returning();\r\n\r\n  return successResponse(newOrg[0]);\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\content\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\models\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\app\\settings\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\components\\admin\\editor\\tiptap-editor.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'placeholder' is defined but never used.","line":15,"column":51,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":62}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEditor, EditorContent } from '@tiptap/react';\r\nimport StarterKit from '@tiptap/starter-kit';\r\nimport Image from '@tiptap/extension-image';\r\nimport Link from '@tiptap/extension-link';\r\nimport { EditorToolbar } from './toolbar';\r\n\r\ninterface TipTapEditorProps {\r\n    content: string;\r\n    onChange: (content: string) => void;\r\n    placeholder?: string;\r\n}\r\n\r\nexport function TipTapEditor({ content, onChange, placeholder }: TipTapEditorProps) {\r\n    const editor = useEditor({\r\n        extensions: [\r\n            StarterKit,\r\n            Image,\r\n            Link.configure({\r\n                openOnClick: false,\r\n                HTMLAttributes: {\r\n                    class: 'text-primary underline',\r\n                },\r\n            }),\r\n        ],\r\n        content,\r\n        editorProps: {\r\n            attributes: {\r\n                class: 'prose prose-sm sm:prose lg:prose-lg xl:prose-xl focus:outline-none min-h-[400px] max-w-none p-4',\r\n            },\r\n        },\r\n        onUpdate: ({ editor }) => {\r\n            onChange(editor.getHTML());\r\n        },\r\n    });\r\n\r\n    if (!editor) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <div className=\"rounded-md border bg-background\">\r\n            <EditorToolbar editor={editor} />\r\n            <EditorContent editor={editor} />\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\components\\admin\\editor\\toolbar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\components\\admin\\header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\components\\admin\\media\\media-uploader.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'progress' is assigned a value but never used.","line":27,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setProgress' is assigned a value but never used.","line":27,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useCallback } from 'react';\r\nimport { useDropzone } from 'react-dropzone';\r\nimport { Upload, X, File as FileIcon, Loader2 } from 'lucide-react';\r\nimport { cn } from '@/lib/utils';\r\nimport { Button } from '@/components/ui/button';\r\nimport { apiClient } from '@/lib/api-client';\r\n\r\ninterface MediaUploaderProps {\r\n    onUploadComplete: (fileKey: string) => void;\r\n    className?: string;\r\n    accept?: Record<string, string[]>;\r\n    maxSize?: number; // in bytes\r\n}\r\n\r\nexport function MediaUploader({\r\n    onUploadComplete,\r\n    className,\r\n    accept = {\r\n        'image/*': ['.png', '.jpg', '.jpeg', '.gif', '.webp'],\r\n    },\r\n    maxSize = 10 * 1024 * 1024, // 10MB\r\n}: MediaUploaderProps) {\r\n    const [file, setFile] = useState<File | null>(null);\r\n    const [uploading, setUploading] = useState(false);\r\n    const [progress, setProgress] = useState(0);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    const onDrop = useCallback((acceptedFiles: File[]) => {\r\n        if (acceptedFiles.length > 0) {\r\n            setFile(acceptedFiles[0]);\r\n            setError(null);\r\n        }\r\n    }, []);\r\n\r\n    const { getRootProps, getInputProps, isDragActive } = useDropzone({\r\n        onDrop,\r\n        accept,\r\n        maxSize,\r\n        multiple: false,\r\n    });\r\n\r\n    const handleUpload = async () => {\r\n        if (!file) return;\r\n\r\n        setUploading(true);\r\n        setError(null);\r\n\r\n        try {\r\n            // 1. Request upload URL\r\n            // TODO: Get orgId from context or props. Using placeholder for now.\r\n            const { uploadUrl, fileKey } = await apiClient.requestUploadUrl('org-placeholder', {\r\n                filename: file.name,\r\n                mimeType: file.type,\r\n                fileSize: file.size,\r\n            });\r\n\r\n            // 2. Upload file to R2\r\n            await apiClient.uploadFile(uploadUrl, file);\r\n\r\n            // 3. Notify parent\r\n            onUploadComplete(fileKey);\r\n\r\n            // Reset state\r\n            setFile(null);\r\n        } catch (err) {\r\n            console.error('Upload failed:', err);\r\n            setError('Failed to upload file. Please try again.');\r\n        } finally {\r\n            setUploading(false);\r\n        }\r\n    };\r\n\r\n    const removeFile = () => {\r\n        setFile(null);\r\n        setError(null);\r\n    };\r\n\r\n    return (\r\n        <div className={cn('w-full', className)}>\r\n            {!file ? (\r\n                <div\r\n                    {...getRootProps()}\r\n                    className={cn(\r\n                        'border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors hover:bg-muted/50',\r\n                        isDragActive ? 'border-primary bg-muted/50' : 'border-muted-foreground/25',\r\n                        error && 'border-destructive/50 bg-destructive/5'\r\n                    )}\r\n                >\r\n                    <input {...getInputProps()} />\r\n                    <div className=\"flex flex-col items-center gap-2\">\r\n                        <Upload className=\"h-8 w-8 text-muted-foreground\" />\r\n                        <p className=\"text-sm font-medium text-muted-foreground\">\r\n                            {isDragActive ? 'Drop the file here' : 'Drag & drop a file here, or click to select'}\r\n                        </p>\r\n                        <p className=\"text-xs text-muted-foreground/70\">\r\n                            Max size: {Math.round(maxSize / 1024 / 1024)}MB\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n            ) : (\r\n                <div className=\"border rounded-lg p-4 space-y-4\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"h-10 w-10 rounded-lg bg-muted flex items-center justify-center\">\r\n                                <FileIcon className=\"h-5 w-5 text-muted-foreground\" />\r\n                            </div>\r\n                            <div className=\"space-y-0.5\">\r\n                                <p className=\"text-sm font-medium truncate max-w-[200px]\">{file.name}</p>\r\n                                <p className=\"text-xs text-muted-foreground\">\r\n                                    {(file.size / 1024).toFixed(1)} KB\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                        {!uploading && (\r\n                            <Button variant=\"ghost\" size=\"icon\" onClick={removeFile}>\r\n                                <X className=\"h-4 w-4\" />\r\n                            </Button>\r\n                        )}\r\n                    </div>\r\n\r\n                    {error && <p className=\"text-sm text-destructive\">{error}</p>}\r\n\r\n                    <Button\r\n                        className=\"w-full\"\r\n                        onClick={handleUpload}\r\n                        disabled={uploading}\r\n                    >\r\n                        {uploading ? (\r\n                            <>\r\n                                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                                Uploading...\r\n                            </>\r\n                        ) : (\r\n                            'Upload'\r\n                        )}\r\n                    </Button>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\components\\admin\\sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\components\\sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\components\\ui\\button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\components\\ui\\card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\components\\ui\\dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\components\\ui\\dropdown-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\components\\ui\\input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\components\\ui\\label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\components\\ui\\separator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\components\\ui\\textarea.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\db\\client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\db\\schema\\custom-fields.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\db\\schema\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\db\\schema\\media.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\db\\schema\\organizations.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":1,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":43}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { sqliteTable, text, integer, index, uniqueIndex } from 'drizzle-orm/sqlite-core';\r\nimport { nanoid } from 'nanoid';\r\n\r\nexport const organizations = sqliteTable(\r\n  'organizations',\r\n  {\r\n    id: text('id')\r\n      .primaryKey()\r\n      .$defaultFn(() => nanoid()),\r\n    name: text('name').notNull(),\r\n    slug: text('slug').notNull().unique(),\r\n    domain: text('domain'),\r\n    settings: text('settings'), // JSON string\r\n    createdAt: integer('created_at', { mode: 'timestamp' })\r\n      .notNull()\r\n      .$defaultFn(() => new Date()),\r\n    updatedAt: integer('updated_at', { mode: 'timestamp' })\r\n      .notNull()\r\n      .$defaultFn(() => new Date()),\r\n  },\r\n  (table) => ({\r\n    slugIdx: uniqueIndex('idx_organizations_slug').on(table.slug),\r\n  })\r\n);\r\n\r\nexport type Organization = typeof organizations.$inferSelect;\r\nexport type NewOrganization = typeof organizations.$inferInsert;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\db\\schema\\post-types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\db\\schema\\posts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\db\\schema\\roles.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\db\\schema\\taxonomies.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\db\\schema\\users-organizations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\db\\schema\\users.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":1,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":43}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { sqliteTable, text, integer, index, uniqueIndex } from 'drizzle-orm/sqlite-core';\r\nimport { nanoid } from 'nanoid';\r\n\r\nexport const users = sqliteTable(\r\n  'users',\r\n  {\r\n    id: text('id')\r\n      .primaryKey()\r\n      .$defaultFn(() => nanoid()),\r\n    email: text('email').notNull().unique(),\r\n    name: text('name').notNull(),\r\n    avatarUrl: text('avatar_url'),\r\n    isSuperAdmin: integer('is_super_admin', { mode: 'boolean' })\r\n      .notNull()\r\n      .default(false),\r\n    createdAt: integer('created_at', { mode: 'timestamp' })\r\n      .notNull()\r\n      .$defaultFn(() => new Date()),\r\n    updatedAt: integer('updated_at', { mode: 'timestamp' })\r\n      .notNull()\r\n      .$defaultFn(() => new Date()),\r\n  },\r\n  (table) => ({\r\n    emailIdx: uniqueIndex('idx_users_email').on(table.email),\r\n  })\r\n);\r\n\r\nexport type User = typeof users.$inferSelect;\r\nexport type NewUser = typeof users.$inferInsert;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\lib\\api-client\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\lib\\api\\auth-wrapper.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1321,1324],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1321,1324],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { DbClient } from '@/db/client';\r\nimport { getAuthenticatedUser } from '@/lib/auth/middleware';\r\nimport { checkPermission } from '@/lib/auth/permissions';\r\nimport { userHasAccessToOrganization } from '@/lib/auth/organization-context';\r\nimport { Errors } from './response';\r\nimport type { User } from '@/db/schema';\r\nimport type { Permission } from '@/lib/auth/permissions';\r\n\r\nexport interface AuthenticatedContext {\r\n  user: User;\r\n  db: DbClient;\r\n  organizationId?: string;\r\n}\r\n\r\nexport type AuthenticatedHandler = (\r\n  request: Request,\r\n  context: AuthenticatedContext,\r\n  params?: Record<string, string>\r\n) => Promise<Response>;\r\n\r\n/**\r\n * Wraps an API route handler with authentication and permission checks\r\n * @param handler - The route handler function\r\n * @param options - Configuration options\r\n */\r\nexport function withAuth(\r\n  handler: AuthenticatedHandler,\r\n  options?: {\r\n    requiredPermission?: Permission;\r\n    requireOrgAccess?: boolean;\r\n  }\r\n) {\r\n  return async (request: Request, routeParams?: { params: Record<string, string> }) => {\r\n    try {\r\n      // Get D1 database from Cloudflare binding\r\n      // Note: This needs to be adapted based on how Cloudflare bindings work in Next.js\r\n      // For now, we'll assume it's available in the request context\r\n      const db = (request as any).db as DbClient;\r\n      \r\n      if (!db) {\r\n        return Errors.serverError('Database not configured');\r\n      }\r\n\r\n      // Authenticate user\r\n      const user = await getAuthenticatedUser(request, db);\r\n\r\n      // Extract organization ID from route params\r\n      const params = routeParams?.params || {};\r\n      const organizationId = params.orgId;\r\n\r\n      // Check organization access if required\r\n      if (options?.requireOrgAccess && organizationId) {\r\n        const hasAccess = await userHasAccessToOrganization(db, user, organizationId);\r\n        if (!hasAccess) {\r\n          return Errors.forbidden();\r\n        }\r\n      }\r\n\r\n      // Check permission if required\r\n      if (options?.requiredPermission && organizationId) {\r\n        const hasPermission = await checkPermission(\r\n          db,\r\n          user.id,\r\n          organizationId,\r\n          options.requiredPermission\r\n        );\r\n        if (!hasPermission) {\r\n          return Errors.forbidden();\r\n        }\r\n      }\r\n\r\n      // Call the handler with authenticated context\r\n      return handler(request, { user, db, organizationId }, params);\r\n    } catch (error) {\r\n      if (error instanceof Error) {\r\n        if (error.message.includes('Unauthorized')) {\r\n          return Errors.unauthorized();\r\n        }\r\n        return Errors.serverError(error.message);\r\n      }\r\n      return Errors.serverError();\r\n    }\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\lib\\api\\response.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\lib\\api\\validation.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'eq' is defined but never used.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'and' is defined but never used.","line":3,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'gte' is defined but never used.","line":3,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'lte' is defined but never used.","line":3,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SQL' is defined but never used.","line":3,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":49},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sql' is defined but never used.","line":3,"column":51,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":54},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1730,1733],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1730,1733],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'T' is defined but never used.","line":74,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":74,"endColumn":33},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2093,2096],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2093,2096],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2118,2121],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2118,2121],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":82,"column":4,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":7,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2226,2229],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2226,2229],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { z } from 'zod';\r\nimport { Errors } from './response';\r\nimport { eq, and, like, desc, gte, lte, asc, SQL, sql } from 'drizzle-orm';\r\n\r\n/**\r\n * Validates request body against a Zod schema\r\n */\r\nexport async function validateRequest<T>(\r\n  request: Request,\r\n  schema: z.ZodSchema<T>\r\n): Promise<{ success: true; data: T } | { success: false; response: Response }> {\r\n  try {\r\n    const body = await request.json();\r\n    const data = schema.parse(body);\r\n    return { success: true, data };\r\n  } catch (error) {\r\n    if (error instanceof z.ZodError) {\r\n      return {\r\n        success: false,\r\n        response: Errors.validationError(error.errors),\r\n      };\r\n    }\r\n    return {\r\n      success: false,\r\n      response: Errors.badRequest('Invalid request body'),\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Extracts pagination parameters from URL search params\r\n */\r\nexport function getPaginationParams(url: URL): { page: number; perPage: number } {\r\n  const page = Math.max(1, parseInt(url.searchParams.get('page') || '1', 10));\r\n  const perPage = Math.min(\r\n    100,\r\n    Math.max(1, parseInt(url.searchParams.get('per_page') || '20', 10))\r\n  );\r\n  return { page, perPage };\r\n}\r\n\r\n/**\r\n * Calculates offset for pagination\r\n */\r\nexport function getOffset(page: number, perPage: number): number {\r\n  return (page - 1) * perPage;\r\n}\r\n\r\n/**\r\n * Parses a date string from query params, returning undefined if invalid\r\n */\r\nexport function parseDateParam(value: string | null): Date | null {\r\n  if (!value) return null;\r\n  const date = new Date(value);\r\n  if (Number.isNaN(date.getTime())) return null;\r\n  return date;\r\n}\r\n\r\n/**\r\n * Builds a search condition for a text field using LIKE\r\n */\r\nexport function buildSearchCondition<T>(\r\n  field: any,\r\n  search: string | null | undefined\r\n): T[] {\r\n  if (!search) return [];\r\n  return [like(field, `%${search}%`)] as T[];\r\n}\r\n\r\n/**\r\n * Parses sort parameter into drizzle orderBy array\r\n * Format: \"field_asc\" or \"field_desc\" (default: \"createdAt_desc\")\r\n */\r\nexport function parseSortParam<T>(\r\n  sort: string | null | undefined,\r\n  fields: {\r\n    createdAt: any;\r\n    [key: string]: any;\r\n  },\r\n  defaultField: keyof typeof fields = 'createdAt',\r\n  defaultOrder: 'asc' | 'desc' = 'desc'\r\n): any[] {\r\n  if (!sort) {\r\n    return defaultOrder === 'desc'\r\n      ? [desc(fields[defaultField])]\r\n      : [asc(fields[defaultField])];\r\n  }\r\n\r\n  const [field, order] = sort.split('_');\r\n  if (!field || !fields[field]) {\r\n    return defaultOrder === 'desc'\r\n      ? [desc(fields[defaultField])]\r\n      : [asc(fields[defaultField])];\r\n  }\r\n\r\n  return order === 'asc' ? [asc(fields[field])] : [desc(fields[field])];\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\lib\\auth\\cloudflare-access.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\lib\\auth\\middleware.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\lib\\auth\\organization-context.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2326,2329],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2326,2329],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { eq } from 'drizzle-orm';\r\nimport type { DbClient } from '@/db/client';\r\nimport { organizations, usersOrganizations } from '@/db/schema';\r\nimport type { User, Organization } from '@/db/schema';\r\nimport { isSuperAdmin } from './middleware';\r\n\r\n/**\r\n * Extracts organization ID from request URL or headers\r\n * @param request - The incoming request\r\n * @returns The organization ID or null\r\n */\r\nexport function getOrganizationIdFromRequest(request: Request): string | null {\r\n  // Try to get from URL parameter (e.g., /api/admin/organizations/:orgId/...)\r\n  const url = new URL(request.url);\r\n  const pathParts = url.pathname.split('/');\r\n  const orgIndex = pathParts.indexOf('organizations');\r\n  \r\n  if (orgIndex !== -1 && pathParts[orgIndex + 1]) {\r\n    return pathParts[orgIndex + 1];\r\n  }\r\n\r\n  // Try to get from custom header\r\n  return request.headers.get('X-Organization-Id');\r\n}\r\n\r\n/**\r\n * Gets organization by slug\r\n * @param db - The database client\r\n * @param slug - The organization slug\r\n * @returns The organization or null\r\n */\r\nexport async function getOrganizationBySlug(\r\n  db: DbClient,\r\n  slug: string\r\n): Promise<Organization | null> {\r\n  const org = await db.query.organizations.findFirst({\r\n    where: eq(organizations.slug, slug),\r\n  });\r\n\r\n  return org || null;\r\n}\r\n\r\n/**\r\n * Checks if a user has access to an organization\r\n * @param db - The database client\r\n * @param user - The user\r\n * @param organizationId - The organization ID\r\n * @returns True if the user has access\r\n */\r\nexport async function userHasAccessToOrganization(\r\n  db: DbClient,\r\n  user: User,\r\n  organizationId: string\r\n): Promise<boolean> {\r\n  // Super admins have access to all organizations\r\n  if (isSuperAdmin(user)) {\r\n    return true;\r\n  }\r\n\r\n  // Check if user is a member of the organization\r\n  const userOrg = await db.query.usersOrganizations.findFirst({\r\n    where: eq(usersOrganizations.userId, user.id) &&\r\n           eq(usersOrganizations.organizationId, organizationId),\r\n  });\r\n\r\n  return !!userOrg;\r\n}\r\n\r\n/**\r\n * Gets all organizations a user has access to\r\n * @param db - The database client\r\n * @param user - The user\r\n * @returns Array of organizations with user's role\r\n */\r\nexport async function getUserOrganizations(\r\n  db: DbClient,\r\n  user: User\r\n): Promise<Array<{ organization: Organization; role: any }>> {\r\n  // Super admins have access to all organizations\r\n  if (isSuperAdmin(user)) {\r\n    const allOrgs = await db.query.organizations.findMany();\r\n    return allOrgs.map((org) => ({\r\n      organization: org,\r\n      role: { name: 'super_admin', permissions: ['*:*'] },\r\n    }));\r\n  }\r\n\r\n  // Get user's organizations\r\n  const userOrgs = await db.query.usersOrganizations.findMany({\r\n    where: eq(usersOrganizations.userId, user.id),\r\n    with: {\r\n      organization: true,\r\n      role: true,\r\n    },\r\n  });\r\n\r\n  return userOrgs.map((uo) => ({\r\n    organization: uo.organization,\r\n    role: uo.role,\r\n  }));\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\lib\\auth\\permissions.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used.","line":4,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { eq, and } from 'drizzle-orm';\r\nimport type { DbClient } from '@/db/client';\r\nimport { usersOrganizations } from '@/db/schema';\r\nimport type { User } from '@/db/schema';\r\nimport { isSuperAdmin } from './middleware';\r\n\r\nexport type Permission = string; // Format: \"resource:action\" e.g., \"posts:create\"\r\n\r\n/**\r\n * Checks if a user has a specific permission in an organization\r\n * @param db - The database client\r\n * @param userId - The user ID\r\n * @param organizationId - The organization ID\r\n * @param permission - The permission to check (e.g., \"posts:create\")\r\n * @returns True if the user has the permission\r\n */\r\nexport async function checkPermission(\r\n  db: DbClient,\r\n  userId: string,\r\n  organizationId: string,\r\n  permission: Permission\r\n): Promise<boolean> {\r\n  // Check if user is super admin (has all permissions)\r\n  const user = await db.query.users.findFirst({\r\n    where: eq(db.query.users.id, userId),\r\n  });\r\n\r\n  if (user && isSuperAdmin(user)) {\r\n    return true;\r\n  }\r\n\r\n  // Get user's role in the organization\r\n  const userOrg = await db.query.usersOrganizations.findFirst({\r\n    where: and(\r\n      eq(usersOrganizations.userId, userId),\r\n      eq(usersOrganizations.organizationId, organizationId)\r\n    ),\r\n    with: {\r\n      role: true,\r\n    },\r\n  });\r\n\r\n  if (!userOrg) {\r\n    return false; // User not in organization\r\n  }\r\n\r\n  // Parse permissions from role\r\n  const permissions: Permission[] = JSON.parse(userOrg.role.permissions);\r\n\r\n  // Check for exact match or wildcard\r\n  return permissions.some((p) => {\r\n    if (p === permission) return true;\r\n\r\n    // Check wildcard (e.g., \"posts:*\" matches \"posts:create\")\r\n    const [resource, action] = p.split(':');\r\n    const [reqResource] = permission.split(':');\r\n\r\n    return resource === reqResource && action === '*';\r\n  });\r\n}\r\n\r\n/**\r\n * Checks if a user has any of the specified permissions\r\n * @param db - The database client\r\n * @param userId - The user ID\r\n * @param organizationId - The organization ID\r\n * @param permissions - Array of permissions to check\r\n * @returns True if the user has at least one of the permissions\r\n */\r\nexport async function checkAnyPermission(\r\n  db: DbClient,\r\n  userId: string,\r\n  organizationId: string,\r\n  permissions: Permission[]\r\n): Promise<boolean> {\r\n  for (const permission of permissions) {\r\n    if (await checkPermission(db, userId, organizationId, permission)) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Checks if a user has all of the specified permissions\r\n * @param db - The database client\r\n * @param userId - The user ID\r\n * @param organizationId - The organization ID\r\n * @param permissions - Array of permissions to check\r\n * @returns True if the user has all of the permissions\r\n */\r\nexport async function checkAllPermissions(\r\n  db: DbClient,\r\n  userId: string,\r\n  organizationId: string,\r\n  permissions: Permission[]\r\n): Promise<boolean> {\r\n  for (const permission of permissions) {\r\n    if (!(await checkPermission(db, userId, organizationId, permission))) {\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\n/**\r\n * Gets all permissions for a user in an organization\r\n * @param db - The database client\r\n * @param userId - The user ID\r\n * @param organizationId - The organization ID\r\n * @returns Array of permissions\r\n */\r\nexport async function getUserPermissions(\r\n  db: DbClient,\r\n  userId: string,\r\n  organizationId: string\r\n): Promise<Permission[]> {\r\n  // Check if user is super admin\r\n  const user = await db.query.users.findFirst({\r\n    where: eq(db.query.users.id, userId),\r\n  });\r\n\r\n  if (user && isSuperAdmin(user)) {\r\n    return ['*:*']; // Super admin has all permissions\r\n  }\r\n\r\n  // Get user's role in the organization\r\n  const userOrg = await db.query.usersOrganizations.findFirst({\r\n    where: and(\r\n      eq(usersOrganizations.userId, userId),\r\n      eq(usersOrganizations.organizationId, organizationId)\r\n    ),\r\n    with: {\r\n      role: true,\r\n    },\r\n  });\r\n\r\n  if (!userOrg) {\r\n    return [];\r\n  }\r\n\r\n  return JSON.parse(userOrg.role.permissions);\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\lib\\context\\organization-context.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\lib\\context\\organization-context.tsx:34:9\n  32 |       const org = organizations.find((o) => o.id === storedOrgId);\n  33 |       if (org) {\n> 34 |         setOrganizationState(org);\n     |         ^^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  35 |       }\n  36 |     }\n  37 |     setIsLoading(false);","line":34,"column":9,"nodeType":null,"endLine":34,"endColumn":29}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { createContext, useContext, useState, useEffect, ReactNode } from 'react';\r\n\r\ninterface Organization {\r\n  id: string;\r\n  name: string;\r\n  slug: string;\r\n}\r\n\r\ninterface OrganizationContextType {\r\n  organization: Organization | null;\r\n  setOrganization: (org: Organization | null) => void;\r\n  organizations: Organization[];\r\n  setOrganizations: (orgs: Organization[]) => void;\r\n  isLoading: boolean;\r\n}\r\n\r\nconst OrganizationContext = createContext<OrganizationContextType | undefined>(undefined);\r\n\r\nconst STORAGE_KEY = 'omni-cms-current-org-id';\r\n\r\nexport function OrganizationProvider({ children }: { children: ReactNode }) {\r\n  const [organization, setOrganizationState] = useState<Organization | null>(null);\r\n  const [organizations, setOrganizations] = useState<Organization[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  // Load organization from localStorage on mount\r\n  useEffect(() => {\r\n    const storedOrgId = localStorage.getItem(STORAGE_KEY);\r\n    if (storedOrgId && organizations.length > 0) {\r\n      const org = organizations.find((o) => o.id === storedOrgId);\r\n      if (org) {\r\n        setOrganizationState(org);\r\n      }\r\n    }\r\n    setIsLoading(false);\r\n  }, [organizations]);\r\n\r\n  const setOrganization = (org: Organization | null) => {\r\n    setOrganizationState(org);\r\n    if (org) {\r\n      localStorage.setItem(STORAGE_KEY, org.id);\r\n    } else {\r\n      localStorage.removeItem(STORAGE_KEY);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <OrganizationContext.Provider\r\n      value={{\r\n        organization,\r\n        setOrganization,\r\n        organizations,\r\n        setOrganizations,\r\n        isLoading,\r\n      }}\r\n    >\r\n      {children}\r\n    </OrganizationContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useOrganization() {\r\n  const context = useContext(OrganizationContext);\r\n  if (context === undefined) {\r\n    throw new Error('useOrganization must be used within an OrganizationProvider');\r\n  }\r\n  return context;\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\lib\\db\\seed.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\lib\\hooks\\use-api-client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\lib\\media\\urls.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\lib\\storage\\r2-client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\lib\\storage\\upload.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\lib\\validations\\organization.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\lib\\validations\\post-type.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\lib\\validations\\post.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\lib\\validations\\taxonomy.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\types\\auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Acer\\OneDrive\\Documents\\Software Projects\\SINCUNI\\omni-cms\\web\\src\\types\\database.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]